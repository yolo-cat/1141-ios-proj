# Supabase READMEï¼ˆéšæ®µä¸€ï¼‰

**ç‹€æ…‹ï¼šâœ… å·²å®Œæˆå¯¦ä½œ**

ç›®æ¨™ï¼šä¾ `supabase/AGENTS.md`ã€`../PRD_STAGE1.md`ï¼ˆæ‘˜è¦æ–¼ `PRD_SUPABASE_STAGE_1.md`ï¼‰å»ºç«‹ `readings` è¡¨ä¸¦è¨­å®š RLSã€‚`supabase/TASKS_SUPABASE_STAGE_1.md` æä¾›é€ŸæŸ¥æ¸…å–®ï¼Œæœ¬ README ä¿ç•™æŒ‡ä»¤ç¯„ä¾‹ã€‚

## ğŸ“ å·²å¯¦ä½œæª”æ¡ˆ
- `001_create_readings_table.sql` - è³‡æ–™åº«é·ç§»æª”æ¡ˆï¼ˆå¯é‡è¤‡åŸ·è¡Œï¼‰
- `test_supabase_stage1.sh` - è‡ªå‹•åŒ–æ¸¬è©¦è…³æœ¬
- `SETUP_GUIDE.md` - å®Œæ•´å¯¦ä½œæŒ‡å—

è©³ç´°çš„å¯¦ä½œæ­¥é©Ÿå’Œæ¸¬è©¦æ–¹æ³•è«‹åƒè€ƒ [`SETUP_GUIDE.md`](./SETUP_GUIDE.md)ã€‚

## æ¥µç°¡æ­¥é©Ÿ

### ä½¿ç”¨å·²å¯¦ä½œçš„é·ç§»æª”æ¡ˆï¼ˆæ¨è–¦ï¼‰
```bash
# åœ¨ Supabase SQL Editor ä¸­åŸ·è¡Œ
# è¤‡è£½ä¸¦åŸ·è¡Œ 001_create_readings_table.sql çš„å…§å®¹
```

è©³ç´°æ­¥é©Ÿè«‹åƒè€ƒ [`SETUP_GUIDE.md`](./SETUP_GUIDE.md)ã€‚

### SQL å…§å®¹åƒè€ƒ
1) å–å¾— `project ref`ã€`anon key`ã€`authenticated access token`ã€‚  
2) SQLï¼ˆå¯é‡è¤‡åŸ·è¡Œï¼Œç›´æ¥è²¼å…¥ SQL Editor / CLIï¼‰ï¼š
```sql
create table if not exists public.readings (
  id int8 generated by default as identity primary key, -- å”¯ä¸€è­˜åˆ¥ç¢¼
  created_at timestamptz not null default now(),        -- ä¸Šå‚³æ™‚é–“
  device_id text not null,                              -- è£ç½®/èŒ¶å€‰ ID
  temperature float4 not null,                          -- æ”æ°æº«åº¦
  humidity float4 not null                              -- ç›¸å°æ¿•åº¦
);

alter table public.readings enable row level security;
drop policy if exists "allow anon insert" on public.readings;
create policy "allow anon insert" on public.readings for insert to anon with check (true);
drop policy if exists "allow authenticated select" on public.readings;
create policy "allow authenticated select" on public.readings for select to authenticated using (true);
```

3) REST é©—è­‰

### è‡ªå‹•åŒ–æ¸¬è©¦ï¼ˆæ¨è–¦ï¼‰
```bash
./test_supabase_stage1.sh <PROJECT_REF> <ANON_KEY> <ACCESS_TOKEN>
```

### æ‰‹å‹•æ¸¬è©¦ç¯„ä¾‹
- POSTï¼ˆanonï¼Œé æœŸ 201ï¼Œè«‹æ›¿æ›ç‚ºå¯¦éš›æ¸¬è©¦æ•¸å€¼ï¼‰ï¼š
```bash
curl -X POST "https://<PROJECT_REF>.supabase.co/rest/v1/readings" \
  -H "apikey: $SUPABASE_ANON_KEY" \
  -H "Authorization: Bearer $SUPABASE_ANON_KEY" \
  -H "Content-Type: application/json" \
  -H "Prefer: return=minimal" \
  -d '{"device_id":"tea_room_01","temperature":25.5,"humidity":62.0}'
```
- SELECTï¼ˆauthenticatedï¼Œé æœŸ 200ï¼‰ï¼š
```bash
curl "https://<PROJECT_REF>.supabase.co/rest/v1/readings?select=*" \
  -H "apikey: $SUPABASE_ANON_KEY" \
  -H "Authorization: Bearer $ACCESS_TOKEN"
```

4) äº¤ä»˜æª¢æŸ¥
- âœ… SQL migration æª”æ¡ˆï¼š`001_create_readings_table.sql`
- âœ… æ¸¬è©¦è…³æœ¬ï¼š`test_supabase_stage1.sh`
- âœ… å¯¦ä½œæŒ‡å—ï¼š`SETUP_GUIDE.md`
- âœ… æ¬„ä½å‹åˆ¥ä¿æŒ `float4`
- âœ… RLS ç­–ç•¥ï¼šanon insertã€authenticated select
- âœ… æ•ˆèƒ½ç´¢å¼•ï¼šå·²å»ºç«‹ `created_at` å’Œ `device_id` ç´¢å¼•
