# Supabase README（階段一）

目標：依 `supabase/AGENTS.md`、 `stage_1_prd.md` 建立 `readings` 表並設定 RLS。`supabase/TASKS.md` 提供速查清單，本 README 保留指令範例。

## 極簡步驟
1) 取得 `project ref`、`anon key`、`authenticated access token`。  
2) SQL（可重複執行，直接貼入 SQL Editor / CLI）：
```sql
create table if not exists public.readings (
  id int8 generated by default as identity primary key, -- 唯一識別碼
  created_at timestamptz not null default now(),        -- 上傳時間
  device_id text not null,                              -- 裝置/茶倉 ID
  temperature float4 not null,                          -- 攝氏溫度
  humidity float4 not null                              -- 相對濕度
);

alter table public.readings enable row level security;
drop policy if exists "allow anon insert" on public.readings;
create policy "allow anon insert" on public.readings for insert to anon with check (true);
drop policy if exists "allow authenticated select" on public.readings;
create policy "allow authenticated select" on public.readings for select to authenticated using (true);
```

3) REST 驗證  
- POST（anon，預期 201，請替換為實際測試數值）：
```bash
curl -X POST "https://<PROJECT_REF>.supabase.co/rest/v1/readings" \
  -H "apikey: $SUPABASE_ANON_KEY" \
  -H "Authorization: Bearer $SUPABASE_ANON_KEY" \
  -H "Content-Type: application/json" \
  -H "Prefer: return=minimal" \
  -d '{"device_id":"tea_room_01","temperature":25.5,"humidity":62.0}'
```
- SELECT（authenticated，預期 200）：
```bash
curl "https://<PROJECT_REF>.supabase.co/rest/v1/readings?select=*" \
  -H "apikey: $SUPABASE_ANON_KEY" \
  -H "Authorization: Bearer $ACCESS_TOKEN"
```

4) 交付檢查  
- SQL / migration 檔留在 `supabase/`。  
- 欄位型別保持 `float4`；RLS 為 anon insert、authenticated select。
