# Supabase 任務指引（Stage 1）

速查清單：依 PRD 建立 `readings` 表、設定 RLS、完成 REST 驗證。

1. 讀 `supabase/AGENTS.md`、`../PRD_STAGE1.md`（摘要於 `PRD_SUPABASE_STAGE_1.md`），確認 schema/RLS 要求。
2. 取得 `project ref`、`anon key`、`authenticated access token`（用於 SELECT 驗證）。
3. 在 Supabase SQL Editor / CLI 執行：
  ```sql
  create table if not exists public.readings (
    id int8 generated by default as identity primary key,
    created_at timestamptz not null default now(),
    device_id text not null,
    temperature float4 not null,
    humidity float4 not null
  );

  alter table public.readings enable row level security;
  drop policy if exists "allow anon insert" on public.readings;
  create policy "allow anon insert" on public.readings for insert to anon with check (true);
  drop policy if exists "allow authenticated select" on public.readings;
  create policy "allow authenticated select" on public.readings for select to authenticated using (true);
  ```
4. 驗證 REST：  
   - `POST` with anon：預期 201  
   - `SELECT` with authenticated token：預期 200 並可取回資料  
   範例指令見 `supabase/README.md`。
5. 將使用的 SQL / migration 檔放入 `supabase/`，確認欄位型別維持 `float4`。
