# Supabase 開發指南（Stage 1）

**狀態：✅ 已完成實作**  
**完成日期：2025-12-13**

## 核心目標

✅ 依 `../PRD_STAGE1.md`（摘要見 `PRD_SUPABASE_STAGE_1.md`）建立 `readings` 資料表：
  - `id int8 generated by default as identity primary key`
  - `created_at timestamptz not null default now()`
  - `device_id text not null`
  - `temperature float4 not null`
  - `humidity float4 not null`

✅ 啟用 RLS，策略：
  - INSERT：允許 `anon` 寫入（給 ESP32 使用）
  - SELECT：僅 `authenticated` 可讀取

✅ 額外優化：
  - 建立效能索引（`created_at`, `device_id`）
  - 增加資料表和欄位註解
  - 實作自動化測試腳本

## 產出與存放

✅ 已完成的檔案（存放於 `supabase/` 目錄）：
- `001_create_readings_table.sql` - SQL 遷移檔案（支持冪等性）
- `test_supabase_stage1.sh` - 自動化測試腳本
- `SETUP_GUIDE.md` - 完整實作指南
- 已同步更新：`README.md`、`TASKS_SUPABASE_STAGE_1.md`、`DESIGN_SUPABASE_STAGE_1.md`、`PRD_SUPABASE_STAGE_1.md`

## 作業原則（已遵循）

✅ 一切以 PRD（`../PRD_STAGE1.md`）與根目錄 `AGENTS.md` 為準，未變更欄位型別（溫濕度皆用 `float4`）。

✅ 透過 Supabase SQL Editor 或 CLI 執行，命令可重複（idempotent，重複執行不會造成錯誤）。

✅ REST 端點為 `https://<PROJECT_REF>.supabase.co/rest/v1/readings`，HTTP 標頭包含 `apikey` 與 `Authorization: Bearer <SUPABASE_ANON_KEY>`。

## 使用指南

開發者請參考：
1. **快速開始**：`README.md` - 指令範例和快速參考
2. **完整指南**：`SETUP_GUIDE.md` - 詳細設置步驟和故障排除
3. **任務清單**：`TASKS_SUPABASE_STAGE_1.md` - 完成狀態檢查
4. **設計文檔**：`DESIGN_SUPABASE_STAGE_1.md` - 技術設計細節
