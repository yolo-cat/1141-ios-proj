# PRD_SUPABASE_STAGE_1

**狀態：✅ 已完成實作**  
**完成日期：2025-12-13**

此文件摘錄 Supabase 端的 Stage 1 需求（完整需求請見 [`../PRD_STAGE1.md`](../PRD_STAGE1.md)）。

## 需求摘要

- ✅ 資料表：`readings`
  - `id int8 generated by default as identity primary key`
  - `created_at timestamptz not null default now()`
  - `device_id text not null`
  - `temperature float4 not null`
  - `humidity float4 not null`
  
- ✅ 權限：啟用 RLS，允許 `anon` 進行 INSERT，僅 `authenticated` 角色可 SELECT。

- ✅ 介面：REST 端點 `https://<PROJECT_REF>.supabase.co/rest/v1/readings`，標頭含 `apikey` 與 `Authorization: Bearer <anon>`。

## 實作檔案

- `001_create_readings_table.sql` - 資料庫遷移檔案
- `test_supabase_stage1.sh` - 自動化測試腳本
- `SETUP_GUIDE.md` - 完整實作與測試指南

## 驗證標準

- ✅ ESP32（anon key）可成功 POST 數據（HTTP 201）
- ✅ ESP32（anon key）無法 GET 數據（RLS 保護）
- ✅ iOS App（authenticated token）可成功 GET 數據（HTTP 200）
- ✅ 資料表包含所需的效能索引
- ✅ SQL 支持冪等性（可重複執行）

詳細設計請參考 [`DESIGN_SUPABASE_STAGE_1.md`](DESIGN_SUPABASE_STAGE_1.md)。
